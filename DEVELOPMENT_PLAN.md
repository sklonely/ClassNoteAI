# ClassNote AI 開發計畫

**版本**: v1.0  
**日期**: 2025-12-02  
**狀態**: 進行中

---

## 📋 目錄

- [1. 項目現狀](#1-項目現狀)
- [2. MVP 範圍](#2-mvp-範圍)
- [3. 開發階段劃分](#3-開發階段劃分)
- [4. 詳細任務清單](#4-詳細任務清單)
- [5. 技術棧](#5-技術棧)
- [6. 風險與緩解](#6-風險與緩解)
- [7. 里程碑](#7-里程碑)

---

## 1. 項目現狀

### 1.1 已完成 ✅

- ✅ **基礎項目結構**
  - Tauri + React + TypeScript 項目初始化
  - Tailwind CSS 3.4.0 配置完成
  - PostCSS 和 Autoprefixer 配置

- ✅ **UI 框架**
  - MainWindow 主窗口布局
  - LectureView 上課視圖（UI 框架）
  - NotesView 筆記視圖（UI 框架）
  - SettingsView 設置視圖（UI 框架）

- ✅ **基礎功能**
  - React Router 路由系統
  - 深色/淺色主題切換
  - TypeScript 類型定義
  - 主題管理工具

### 1.2 待實現 ⏳

- ⏳ PDF 查看器功能
- ⏳ 音頻錄製功能
- ⏳ Rust 後端 ASR 服務
- ⏳ 字幕顯示邏輯
- ⏳ 數據存儲（SQLite）
- ⏳ 設置功能實現
- ⏳ AI 助教功能（可選）
- ⏳ 筆記生成功能（可選）

---

## 2. MVP 範圍

### 2.1 核心功能（必須實現）

1. **PDF 查看器**
   - PDF.js 集成
   - 文件打開和顯示
   - 頁面導航
   - 縮放功能

2. **音頻錄製**
   - Web Audio API 錄製
   - 麥克風設備選擇
   - 音量監控

3. **本地 ASR 服務**
   - Rust Whisper 集成（whisper-rs 或 whisper.cpp）
   - 實時轉錄（< 2 秒延遲）
   - 粗字幕顯示

4. **字幕顯示**
   - 實時字幕更新
   - 字幕歷史記錄
   - 時間戳顯示

5. **數據存儲**
   - SQLite 數據庫
   - 課程數據存儲
   - 字幕數據存儲

6. **設置功能**
   - 服務器配置
   - 音頻設備選擇
   - 字幕設置

### 2.2 可選功能（後續實現）

- ⏸️ 遠程服務端 ASR（精字幕）
- ⏸️ 中英翻譯
- ⏸️ AI 助教對話
- ⏸️ 課後筆記生成
- ⏸️ 筆記導出（Markdown/PDF）

---

## 3. 開發階段劃分

### 階段一：PDF 查看器集成（1 週）

**目標**：實現 PDF 文件的打開、顯示和基本操作

**任務**：
- [ ] 集成 PDF.js
- [ ] 實現文件選擇對話框（Tauri API）
- [ ] 實現 PDF 渲染組件
- [ ] 實現頁面導航功能
- [ ] 實現縮放功能
- [ ] 實現文本提取功能

**交付物**：
- PDF 查看器組件
- 文件選擇功能
- 基本導航和縮放

---

### 階段二：音頻錄製功能（1 週）

**目標**：實現前端音頻錄製和處理

**任務**：
- [ ] 實現 Web Audio API 錄製
- [ ] 實現麥克風設備列舉和選擇
- [ ] 實現音頻格式轉換（16kHz, 16-bit, Mono）
- [ ] 實現音量監控和可視化
- [ ] 實現音頻數據緩衝
- [ ] 實現語音活動檢測（VAD，基礎版）

**交付物**：
- 音頻錄製服務（services/audio.ts）
- 錄音控制組件
- 音量顯示組件

---

### 階段三：Rust 後端 ASR 服務（2-3 週）

**目標**：實現本地 Whisper ASR 服務

**任務**：
- [ ] 研究並選擇 Whisper Rust 實現（whisper-rs vs whisper.cpp）
- [ ] 實現 Tauri Commands API
- [ ] 實現音頻數據接收和處理
- [ ] 集成 Whisper 模型
- [ ] 實現音頻切片處理（2-4 秒）
- [ ] 實現轉錄結果返回
- [ ] 性能測試和優化（目標：< 2 秒延遲）

**交付物**：
- Rust ASR 服務模塊
- Tauri Commands API
- 性能測試報告

**風險**：
- Whisper Rust 實現性能可能不足
- **緩解**：先實現原型測試，必要時使用 whisper.cpp (FFI)

---

### 階段四：字幕顯示和數據存儲（1-2 週）

**目標**：實現字幕顯示邏輯和數據持久化

**任務**：
- [ ] 實現字幕數據模型
- [ ] 實現字幕顯示組件
- [ ] 實現字幕歷史記錄
- [ ] 實現 SQLite 數據庫初始化
- [ ] 實現課程數據模型
- [ ] 實現數據存儲服務
- [ ] 實現數據查詢和更新

**交付物**：
- 字幕顯示組件
- 數據存儲服務（services/storage.ts）
- SQLite 數據庫結構

---

### 階段五：設置功能實現（1 週）

**目標**：實現完整的設置功能

**任務**：
- [ ] 實現設置數據模型
- [ ] 實現設置持久化（本地存儲）
- [ ] 實現服務器配置功能
- [ ] 實現音頻設備選擇功能
- [ ] 實現字幕設置功能
- [ ] 實現設置驗證和錯誤處理

**交付物**：
- 設置服務（services/settings.ts）
- 設置 UI 完整實現

---

### 階段六：集成測試和優化（1-2 週）

**目標**：整合所有功能，進行測試和優化

**任務**：
- [ ] 端到端功能測試
- [ ] 性能測試（延遲、內存、CPU）
- [ ] 錯誤處理完善
- [ ] UI/UX 優化
- [ ] 跨平台測試（macOS/Windows/Linux）
- [ ] 文檔完善

**交付物**：
- 完整的 MVP 應用
- 測試報告
- 用戶文檔

---

## 4. 詳細任務清單

### 4.1 PDF 查看器（優先級：高）

#### 任務 1.1：PDF.js 集成
- [ ] 安裝 pdfjs-dist
- [ ] 配置 PDF.js worker
- [ ] 創建 PDFViewer 組件
- [ ] 實現 PDF 文件加載
- [ ] 實現 PDF 頁面渲染

**估計時間**：1 天

#### 任務 1.2：文件選擇功能
- [ ] 使用 Tauri dialog API
- [ ] 實現文件選擇對話框
- [ ] 實現文件路徑處理
- [ ] 實現錯誤處理

**估計時間**：0.5 天

#### 任務 1.3：PDF 導航功能
- [ ] 實現上一頁/下一頁
- [ ] 實現頁面跳轉
- [ ] 實現頁面指示器
- [ ] 實現快捷鍵支持

**估計時間**：1 天

#### 任務 1.4：PDF 縮放功能
- [ ] 實現縮放控制
- [ ] 實現適應窗口功能
- [ ] 實現滾輪縮放
- [ ] 實現縮放指示器

**估計時間**：1 天

#### 任務 1.5：文本提取功能
- [ ] 實現當前頁面文本提取
- [ ] 實現文本選擇和複製
- [ ] 實現文本格式化

**估計時間**：0.5 天

**總計**：4 天

---

### 4.2 音頻錄製功能（優先級：高）

#### 任務 2.1：Web Audio API 基礎實現
- [ ] 實現音頻上下文初始化
- [ ] 實現麥克風權限請求
- [ ] 實現音頻流獲取
- [ ] 實現音頻數據採集

**估計時間**：1 天

#### 任務 2.2：音頻設備管理
- [ ] 實現設備列舉
- [ ] 實現設備選擇
- [ ] 實現設備切換
- [ ] 實現設備狀態顯示

**估計時間**：1 天

#### 任務 2.3：音頻格式處理
- [ ] 實現採樣率轉換（16kHz）
- [ ] 實現位深度轉換（16-bit）
- [ ] 實現聲道轉換（Mono）
- [ ] 實現音頻緩衝管理

**估計時間**：1.5 天

#### 任務 2.4：音量監控
- [ ] 實現音量計算
- [ ] 實現音量可視化
- [ ] 實現音量閾值檢測
- [ ] 實現靜音檢測

**估計時間**：1 天

#### 任務 2.5：語音活動檢測（VAD）
- [ ] 實現基礎 VAD 算法
- [ ] 實現靈敏度配置
- [ ] 實現靜音過濾
- [ ] 實現語音片段標記

**估計時間**：1.5 天

**總計**：6 天

---

### 4.3 Rust 後端 ASR 服務（優先級：高）

#### 任務 3.1：Whisper 實現選擇和測試
- [ ] 研究 whisper-rs
- [ ] 研究 whisper.cpp (FFI)
- [ ] 實現原型測試
- [ ] 性能對比測試
- [ ] 選擇最終方案

**估計時間**：2 天

#### 任務 3.2：Tauri Commands API 設計
- [ ] 設計 API 接口
- [ ] 實現音頻數據接收 Command
- [ ] 實現轉錄請求 Command
- [ ] 實現狀態查詢 Command
- [ ] 實現錯誤處理

**估計時間**：1 天

#### 任務 3.3：Whisper 模型集成
- [ ] 實現模型加載
- [ ] 實現模型管理
- [ ] 實現模型下載（可選）
- [ ] 實現模型切換

**估計時間**：2 天

#### 任務 3.4：音頻處理邏輯
- [ ] 實現音頻數據接收
- [ ] 實現音頻格式驗證
- [ ] 實現音頻切片（2-4 秒）
- [ ] 實現音頻緩衝管理

**估計時間**：2 天

#### 任務 3.5：轉錄邏輯實現
- [ ] 實現轉錄請求處理
- [ ] 實現轉錄結果生成
- [ ] 實現結果格式化
- [ ] 實現錯誤處理

**估計時間**：2 天

#### 任務 3.6：性能優化
- [ ] 性能測試
- [ ] 延遲優化（目標：< 2 秒）
- [ ] 內存優化
- [ ] CPU 使用優化

**估計時間**：2 天

**總計**：11 天

---

### 4.4 字幕顯示和數據存儲（優先級：高）

#### 任務 4.1：字幕數據模型
- [ ] 定義字幕類型
- [ ] 實現字幕狀態管理
- [ ] 實現字幕更新邏輯
- [ ] 實現字幕緩存

**估計時間**：1 天

#### 任務 4.2：字幕顯示組件
- [ ] 實現實時字幕顯示
- [ ] 實現字幕樣式配置
- [ ] 實現字幕位置調整
- [ ] 實現字幕動畫效果

**估計時間**：2 天

#### 任務 4.3：字幕歷史記錄
- [ ] 實現歷史記錄組件
- [ ] 實現滾動功能
- [ ] 實現搜索功能
- [ ] 實現導出功能

**估計時間**：1.5 天

#### 任務 4.4：SQLite 數據庫設計
- [ ] 設計數據庫結構
- [ ] 實現數據庫初始化
- [ ] 實現表創建
- [ ] 實現索引創建

**估計時間**：1 天

#### 任務 4.5：數據存儲服務
- [ ] 實現課程數據存儲
- [ ] 實現字幕數據存儲
- [ ] 實現數據查詢
- [ ] 實現數據更新和刪除

**估計時間**：2 天

**總計**：7.5 天

---

### 4.5 設置功能實現（優先級：中）

#### 任務 5.1：設置數據模型
- [ ] 定義設置類型
- [ ] 實現設置默認值
- [ ] 實現設置驗證

**估計時間**：0.5 天

#### 任務 5.2：設置持久化
- [ ] 實現本地存儲（Tauri store）
- [ ] 實現設置讀取
- [ ] 實現設置保存
- [ ] 實現設置同步

**估計時間**：1 天

#### 任務 5.3：服務器配置
- [ ] 實現 URL 配置
- [ ] 實現端口配置
- [ ] 實現連接測試
- [ ] 實現錯誤處理

**估計時間**：1 天

#### 任務 5.4：音頻設置
- [ ] 實現設備選擇
- [ ] 實現採樣率設置
- [ ] 實現 VAD 靈敏度設置

**估計時間**：1 天

#### 任務 5.5：字幕設置
- [ ] 實現字體大小設置
- [ ] 實現顏色設置
- [ ] 實現位置設置
- [ ] 實現顯示模式設置

**估計時間**：1 天

**總計**：4.5 天

---

### 4.6 集成測試和優化（優先級：高）

#### 任務 6.1：端到端測試
- [ ] 編寫測試用例
- [ ] 實現自動化測試
- [ ] 執行功能測試
- [ ] 修復發現的問題

**估計時間**：2 天

#### 任務 6.2：性能測試
- [ ] 延遲測試
- [ ] 內存使用測試
- [ ] CPU 使用測試
- [ ] 優化性能瓶頸

**估計時間**：2 天

#### 任務 6.3：錯誤處理完善
- [ ] 實現全局錯誤處理
- [ ] 實現用戶友好的錯誤提示
- [ ] 實現錯誤日誌記錄
- [ ] 實現錯誤恢復機制

**估計時間**：1.5 天

#### 任務 6.4：UI/UX 優化
- [ ] 界面細節優化
- [ ] 動畫效果優化
- [ ] 響應式設計優化
- [ ] 無障礙功能優化

**估計時間**：2 天

#### 任務 6.5：跨平台測試
- [ ] macOS 測試
- [ ] Windows 測試（如可用）
- [ ] Linux 測試（如可用）
- [ ] 平台特定問題修復

**估計時間**：2 天

#### 任務 6.6：文檔完善
- [ ] 用戶文檔
- [ ] 開發文檔
- [ ] API 文檔
- [ ] 部署文檔

**估計時間**：1.5 天

**總計**：11 天

---

## 5. 技術棧

### 5.1 前端技術

- **框架**: React 18 + TypeScript
- **樣式**: Tailwind CSS 3.4.0
- **路由**: React Router DOM
- **狀態管理**: React Hooks + Context（後續可考慮 Zustand）
- **PDF 渲染**: PDF.js
- **圖標**: Lucide React

### 5.2 後端技術

- **框架**: Tauri 2.0
- **語言**: Rust
- **ASR**: whisper-rs 或 whisper.cpp
- **數據庫**: SQLite (rusqlite)
- **音頻處理**: cpal（如需要）

### 5.3 開發工具

- **構建工具**: Vite
- **包管理**: npm
- **代碼格式化**: Prettier（建議添加）
- **代碼檢查**: ESLint（建議添加）

---

## 6. 風險與緩解

### 6.1 技術風險

#### 風險 1：Whisper Rust 實現性能不足
- **影響**：高
- **概率**：中
- **緩解措施**：
  1. 先實現原型測試性能
  2. 對比 whisper-rs 和 whisper.cpp
  3. 必要時使用 whisper.cpp (FFI)
  4. 優化音頻切片大小和處理邏輯

#### 風險 2：音頻錄製跨平台兼容性
- **影響**：中
- **概率**：低
- **緩解措施**：
  1. 使用成熟的 Web Audio API
  2. 在不同平台測試
  3. 提供降級方案

#### 風險 3：PDF.js 在 Tauri 中的兼容性
- **影響**：中
- **概率**：低
- **緩解措施**：
  1. 使用最新版本的 PDF.js
  2. 測試 Worker 加載
  3. 提供錯誤處理

### 6.2 進度風險

#### 風險 4：開發時間超期
- **影響**：中
- **概率**：中
- **緩解措施**：
  1. 優先實現 MVP 核心功能
  2. 可選功能延後實現
  3. 定期檢查進度
  4. 及時調整計劃

---

## 7. 里程碑

### 里程碑 1：PDF 查看器完成（第 1 週結束）
- ✅ PDF 文件可以打開和顯示
- ✅ 頁面導航和縮放功能正常
- ✅ 文本提取功能正常

### 里程碑 2：音頻錄製完成（第 2 週結束）
- ✅ 音頻錄製功能正常
- ✅ 設備選擇功能正常
- ✅ 音量監控正常

### 里程碑 3：ASR 服務完成（第 4-5 週結束）
- ✅ Rust ASR 服務正常運行
- ✅ 轉錄延遲 < 2 秒
- ✅ 字幕可以正常顯示

### 里程碑 4：數據存儲完成（第 6 週結束）
- ✅ 數據庫結構完成
- ✅ 數據存儲和查詢正常
- ✅ 字幕歷史記錄正常

### 里程碑 5：設置功能完成（第 7 週結束）
- ✅ 所有設置功能正常
- ✅ 設置持久化正常
- ✅ 設置驗證正常

### 里程碑 6：MVP 完成（第 8-9 週結束）
- ✅ 所有核心功能完成
- ✅ 測試通過
- ✅ 文檔完成
- ✅ 可以發布 MVP 版本

---

## 8. 時間估算

### 8.1 各階段時間

| 階段 | 任務 | 估計時間 |
|------|------|----------|
| 階段一 | PDF 查看器集成 | 4 天 |
| 階段二 | 音頻錄製功能 | 6 天 |
| 階段三 | Rust 後端 ASR 服務 | 11 天 |
| 階段四 | 字幕顯示和數據存儲 | 7.5 天 |
| 階段五 | 設置功能實現 | 4.5 天 |
| 階段六 | 集成測試和優化 | 11 天 |
| **總計** | | **44 天（約 9 週）** |

### 8.2 緩衝時間

考慮到：
- 問題調試和修復：+20%
- 需求變更：+10%
- 學習新技術：+10%

**總計**：44 天 × 1.4 = **約 62 天（約 12-13 週）**

---

## 9. 下一步行動

### 立即開始（本週）

1. **任務 1.1：PDF.js 集成**
   - 安裝 pdfjs-dist
   - 創建 PDFViewer 組件
   - 實現基本 PDF 顯示

2. **任務 2.1：Web Audio API 基礎實現**
   - 研究 Web Audio API
   - 實現音頻上下文初始化
   - 實現基本錄音功能

### 本週目標

- ✅ PDF 查看器基礎功能完成
- ✅ 音頻錄製基礎功能完成
- ✅ 開始研究 Whisper Rust 實現

---

## 10. 附錄

### 10.1 參考資源

- [Tauri 官方文檔](https://tauri.app/)
- [PDF.js 文檔](https://mozilla.github.io/pdf.js/)
- [Web Audio API 文檔](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)
- [Whisper 論文](https://cdn.openai.com/papers/whisper.pdf)
- [whisper-rs GitHub](https://github.com/tazz4843/whisper-rs)
- [whisper.cpp GitHub](https://github.com/ggerganov/whisper.cpp)

### 10.2 更新記錄

| 版本 | 日期 | 變更說明 |
|------|------|----------|
| v1.0 | 2025-12-02 | 初始版本 |

---

**文檔維護者**: ClassNote AI Team  
**最後更新**: 2025-12-02

