# 業務邏輯功能狀態分析

**更新日期**: 2025-01-XX  
**分析目的**: 評估基本業務邏輯的完成度，確定需要新增或提升的功能

---

## 📊 功能完成度總覽

| 功能模塊 | 完成度 | 狀態 | 備註 |
|---------|--------|------|------|
| 數據庫存儲系統 | 100% | ✅ 完成 | SQLite + CRUD 完整 |
| 錄音和轉錄 | 90% | ✅ 完成 | 缺少課程關聯 |
| PDF 加載 | 100% | ✅ 完成 | 支持拖放和選擇 |
| **開始新課程** | 0% | ❌ 缺失 | **需要實現** |
| **保存課程** | 0% | ❌ 缺失 | **需要實現** |
| **加載歷史課程** | 0% | ❌ 缺失 | **需要實現** |
| 筆記查看 | 30% | ⚠️ 部分 | UI 存在，但使用模擬數據 |

---

## ✅ 已實現功能詳情

### 1. 數據庫存儲系統（100% 完成）

#### 後端（Rust）
- ✅ SQLite 數據庫初始化
- ✅ 數據表創建（lectures, subtitles, notes, settings）
- ✅ 完整的 CRUD 操作
- ✅ Tauri Commands 暴露所有操作

#### 前端（TypeScript）
- ✅ `storageService.ts` 完整封裝
- ✅ 類型定義完整（Lecture, Subtitle, Note）
- ✅ 導出/導入功能

**文件位置**:
- `src-tauri/src/storage/` - 後端存儲模塊
- `src/services/storageService.ts` - 前端服務
- `src/types/index.ts` - 類型定義

### 2. 錄音和轉錄功能（90% 完成）

#### 已實現
- ✅ 音頻錄製器（AudioRecorder）
- ✅ Whisper 模型加載和轉錄
- ✅ 實時字幕顯示
- ✅ 翻譯功能（本地 ONNX + Google API）
- ✅ 字幕服務（SubtitleService）

#### 缺失
- ❌ 錄音開始時沒有創建課程記錄
- ❌ 字幕沒有關聯到課程 ID
- ❌ 沒有自動保存字幕到數據庫

**文件位置**:
- `src/components/LectureView.tsx` - 主錄音界面
- `src/services/transcriptionService.ts` - 轉錄服務
- `src/services/subtitleService.ts` - 字幕服務

### 3. PDF 加載功能（100% 完成）

- ✅ PDF 文件選擇
- ✅ 拖放支持
- ✅ PDF 查看器
- ✅ 文本提取

**文件位置**:
- `src/components/PDFViewer.tsx`
- `src/components/DragDropZone.tsx`
- `src/services/fileService.ts`

---

## ❌ 缺失的關鍵業務邏輯

### 1. 開始新課程（0% 完成）

#### 問題
- 用戶無法創建新課程
- 錄音開始時沒有課程記錄
- 沒有課程標題輸入

#### 需要實現
1. **課程創建對話框**
   - 輸入課程標題
   - 可選：選擇 PDF 文件
   - 創建課程記錄

2. **錄音流程整合**
   - 開始錄音前必須創建/選擇課程
   - 錄音開始時創建課程記錄（如果不存在）
   - 將課程 ID 關聯到錄音會話

3. **當前課程狀態管理**
   - 在 `LectureView` 中追蹤當前課程 ID
   - 顯示當前課程標題
   - 提供「新建課程」按鈕

### 2. 保存課程（0% 完成）

#### 問題
- 錄音過程中字幕沒有保存到數據庫
- 停止錄音時沒有保存課程
- 沒有更新課程時長
- 沒有更新課程狀態

#### 需要實現
1. **實時字幕保存**
   - 每當字幕片段生成時，自動保存到數據庫
   - 關聯到當前課程 ID
   - 包含時間戳和翻譯

2. **停止錄音時保存**
   - 更新課程狀態為 "completed"
   - 更新課程時長
   - 保存所有字幕片段
   - 保存 PDF 路徑（如果已加載）

3. **手動保存功能**
   - 「保存課程」按鈕
   - 保存當前狀態（即使還在錄音中）
   - 顯示保存狀態反饋

### 3. 加載歷史課程（0% 完成）

#### 問題
- `NotesView` 使用模擬數據
- 沒有課程列表頁面
- 無法從列表選擇課程
- `LectureView` 無法加載歷史課程

#### 需要實現
1. **課程列表頁面**
   - 從數據庫讀取所有課程
   - 顯示課程標題、日期、時長、狀態
   - 搜索和篩選功能
   - 排序功能（按日期、標題等）

2. **課程選擇功能**
   - 點擊課程進入查看/編輯模式
   - 在 `LectureView` 中加載課程數據
   - 恢復 PDF（如果存在）
   - 恢復字幕歷史

3. **課程管理功能**
   - 刪除課程
   - 編輯課程標題
   - 查看課程詳情

### 4. 筆記查看功能（30% 完成）

#### 已實現
- ✅ UI 框架存在
- ✅ 課程列表 UI（但使用模擬數據）

#### 缺失
- ❌ 沒有從數據庫讀取課程
- ❌ 沒有加載筆記內容
- ❌ 沒有 Markdown 渲染
- ❌ 沒有導出功能實現

---

## 🎯 優先級建議

### 高優先級（核心業務邏輯）

1. **開始新課程** ⭐⭐⭐⭐⭐
   - 用戶無法使用應用，因為無法創建課程
   - 必須先實現才能進行後續功能

2. **保存課程** ⭐⭐⭐⭐⭐
   - 數據會丟失，用戶體驗極差
   - 必須在錄音過程中自動保存

3. **加載歷史課程** ⭐⭐⭐⭐
   - 用戶無法查看之前的課程
   - 影響應用的實用性

### 中優先級（增強功能）

4. **筆記查看功能完善** ⭐⭐⭐
   - UI 已存在，只需連接數據庫

5. **課程管理功能** ⭐⭐⭐
   - 編輯、刪除課程
   - 搜索和篩選

### 低優先級（優化功能）

6. **自動保存優化** ⭐⭐
   - 批量保存字幕
   - 防抖處理

7. **課程統計** ⭐⭐
   - 總時長統計
   - 字幕數量統計

---

## 📝 實現建議

### 階段 1: 核心業務邏輯（必須）

1. **在 `LectureView` 中添加課程管理**
   - 添加「新建課程」按鈕
   - 添加課程標題顯示
   - 追蹤當前課程 ID

2. **實現課程創建流程**
   - 創建 `CourseCreationDialog` 組件
   - 開始錄音前檢查/創建課程
   - 將課程 ID 存儲在狀態中

3. **實現自動保存**
   - 在 `transcriptionService` 中保存字幕時關聯課程 ID
   - 停止錄音時更新課程狀態
   - 定期保存課程（防止數據丟失）

### 階段 2: 歷史課程功能

4. **完善 `NotesView`**
   - 從數據庫讀取課程列表
   - 實現課程選擇
   - 加載課程詳情

5. **實現課程加載**
   - 在 `LectureView` 中添加「加載課程」功能
   - 恢復 PDF 和字幕
   - 顯示歷史字幕

### 階段 3: 增強功能

6. **課程管理**
   - 編輯課程標題
   - 刪除課程
   - 搜索和篩選

7. **筆記功能**
   - Markdown 渲染
   - 導出功能

---

## 🔍 代碼檢查清單

### LectureView.tsx
- [ ] 是否有當前課程 ID 狀態？
- [ ] 是否有課程標題顯示？
- [ ] 開始錄音時是否創建課程？
- [ ] 停止錄音時是否保存課程？
- [ ] 字幕是否關聯到課程 ID？

### transcriptionService.ts
- [ ] 保存字幕時是否包含課程 ID？
- [ ] 是否有自動保存機制？

### NotesView.tsx
- [ ] 是否從數據庫讀取課程？
- [ ] 是否實現課程選擇？
- [ ] 是否加載課程詳情？

### storageService.ts
- [x] CRUD 操作完整
- [x] 類型定義完整

---

## 📌 總結

**核心問題**: 雖然數據庫和存儲系統已經完整實現，但前端業務邏輯層面缺少關鍵的課程管理功能。用戶無法：
1. 創建新課程
2. 保存錄音數據
3. 查看歷史課程

**建議**: 優先實現「開始新課程」和「保存課程」功能，這是應用能夠正常使用的基礎。


